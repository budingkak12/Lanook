# 安卓端“本机文件”Tab 需求（默认读写、无搜索、按需缩略图）

## 功能范围
- 浏览后端所在 PC/mac 的本地文件系统，包含系统盘、用户目录、外接盘、新盘符（D/E…）及已挂载卷。
- 自动发现根；隐藏项默认不显示，可切换显示。
- 支持读写：与系统 Finder/资源管理器体验一致，允许新建/重命名/移动/删除（需确认弹窗）。

## 权限与安全
- 路径模型：`root_id + relative_path`，正斜杠；禁止 `..`、跨根或未授权符号链接跳转。
- 写操作默认开启，但每次危险操作需二次确认；错误需明确原因（权限/不存在/不可写/未挂载）。
- 隐藏项默认关闭；显式 `show_hidden=true` 才返回。

## 后端接口（精简版）
1) `GET /fs/roots`
   - 返回根列表：`id`, `display_name`, `abs_path`, `writable`, `available`, `removable`, `total_bytes`, `free_bytes`, `platform`。
   - 自动枚举：macOS `/`, `/Users/<user>`, `/Volumes/*`; Windows 全盘符 + 用户目录；过滤不可访问项。

2) `GET /fs/list?root_id=&path=&offset=0&limit=100&show_hidden=false&sort=name|mtime|size&order=asc|desc`
   - 目录项：`name`, `is_dir`, `size`, `mtime`, `ext`, `writable`, `thumbnail_url?`, `media_meta?`。
   - 分页：返回 `total/offset/limit`，支持大目录。

3) 写操作（默认启用）
   - `POST /fs/mkdir` `{root_id, path}`
   - `POST /fs/rename` `{root_id, src_path, dst_path}`
   - `POST /fs/delete` `{root_id, paths: []}`
   - `POST /fs/move` / `/fs/copy` `{root_id, src_paths: [], dst_dir}`
   - 错误码：`permission_denied` / `not_found` / `exists` / `dst_not_dir` / `out_of_root` / `unavailable` / `io_error` / `partial_failure`。

4) 文件读取
   - `GET /fs/file?root_id=&path=&disposition=inline|attachment`，支持 Range。

5) 缩略图
   - `GET /fs/thumb?root_id=&path=&w=320&h=320&fit=cover`；按需生成并缓存，非媒体返回占位或 404。

## 前端交互（Compose）
- Tab 名称“本机文件”。根选择器展示所有根与可用状态。
- 面包屑导航；列表/网格切换；排序（名称/时间/大小）。
- 列表项：缩略图懒加载、名称、大小、修改时间、可写角标。
- 长按多选；底部操作栏：删除、移动/复制、重命名、新建文件夹、复制路径、刷新。
- 预览：图片/视频直接打开；其他类型提示“暂不支持预览，可复制路径”。

## 状态与异常
- 未挂载/不可访问根 `available=false`，前端灰显并提示“未连接/未挂载，检查设备”。
- 外接盘拔出：自动回退到根选择并 toast 提示。
- 隐藏项开关记忆；空目录/无结果显示空态文案与“刷新/切换根”。

## 性能与体验
- 大目录分页/游标加载；下拉刷新。
- 缩略图缓存（LRU/尺寸限制可配置）；IO 后台线程，UI 保持流畅。

## 配置建议
- `FS_SHOW_HIDDEN_DEFAULT=false`
- `FS_PAGE_SIZE=100`
- 缩略图缓存目录与上限可配置，按需生成。

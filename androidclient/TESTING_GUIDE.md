# Android 端到端测试指南

本文档旨在说明如何运行和理解项目中的 Android 端到端（E2E）测试脚本。

## 1. 测试脚本实现

测试脚本位于 `app/src/androidTest/java/com/example/androidclient/MainFlowTest.kt`。

它主要使用以下技术实现：

- **JUnit 4**: 一个标准的 Java 测试框架。
- **AndroidX Test**: 提供了在 Android 设备上运行 JUnit 测试的能力。
- **Jetpack Compose Test**: 专门用于测试 Jetpack Compose UI 的一套 API。我们使用 `createAndroidComposeRule` 来启动 `MainActivity` 并与 UI 组件进行交互。

测试通过查找UI元素的 `contentDescription`（内容描述）来定位和断言组件是否存在。例如，它会查找 `contentDescription = "Thumbnail Grid"` 来确认主网格视图已加载。

## 2. 测试脚本功能

该脚本覆盖了应用的核心用户流程，确保最基本的功能可以正常工作。具体流程如下：

1.  **启动应用**：自动启动 `MainActivity`。
2.  **验证主屏幕**：检查缩略图网格 (`ThumbnailGridScreen`) 是否正确显示。
3.  **导航到详情页**：模拟用户点击第一个缩略图，并验证应用是否成功导航到详情页 (`DetailViewScreen`)。
4.  **返回主屏幕**：模拟用户点击返回按钮，并验证应用是否成功返回到缩略图网格界面。

这个测试可以有效地防止后续开发中对核心功能的意外破坏。

### 详情页交互补充用例

为保障近期新增的点赞/收藏与视频控制逻辑，建议在手工或自动化测试中补充以下场景：

1. **视频控制栏联动**  
   - 进入视频详情，单击播放画面显示控制栏，此时底部点赞/收藏条应隐藏；等待控制栏自动消失或再次点按关闭后，操作条应恢复。  
   - 验证图片详情始终展示操作条，不受控制栏影响。

2. **双击仅点赞**  
   - 图片：快速双击确认仅切换点赞状态，不发生缩放或其他动画。  
   - 视频：快速双击仅切换点赞状态且控制栏保持隐藏；模拟接口失败时，按钮颜色需回滚并提示。

3. **状态同步与分页**  
   - 在详情页中多次切换点赞/收藏，返回缩略图列表后状态一致；再次进入同一媒体仍与后端同步。  
   - 在详情页横向切换不同媒体（包括翻页后的新数据），确认每条媒体的点赞/收藏状态独立正确。

4. **异常回滚**  
   - 在网络异常或服务端返回错误时，点赞/收藏失败应提示并恢复旧状态；同时确保视频控制栏显示时提示仍可被看到。

5. **无障碍**  
   - 启用 TalkBack 或其他读屏功能，操作条可正确朗读当前状态；当控制栏出现隐藏操作条时，按钮不会聚焦，控制栏隐藏后功能恢复。

这些用例可配合现有的主流程一起执行，覆盖详情页新增交互的关键路径。

## 3. 如何执行测试

您可以非常方便地通过 Gradle 命令来运行此测试。

1.  确保您已连接了一个 Android 设备或启动了一个模拟器。
2.  在 `androidclient` 目录下打开终端。
3.  执行以下命令：

    ```shell
    .\gradlew.bat connectedAndroidTest
    ```

4.  命令执行完毕后，Gradle 会输出测试结果。如果显示 `BUILD SUCCESSFUL`，则表示所有测试都已通过。

通过遵循本指南，您可以轻松地在开发周期中利用这个自动化测试来保证应用的质量。
